{% extends 'base.html' %}
{% block content %}
<div class="hero fade-up visible">
  <div>
    <h1>KLH Lost & Found</h1>
    <p class="muted">Browse items reported lost on campus or post a new one.</p>
  </div>
  <div class="ms-auto">
    <a href="{% url 'post_item' %}" class="btn btn-primary">Post Lost Item</a>
  </div>
  </div>

<div class="items-grid">
  {% for item in items %}
    <div class="card">
      {% if item.image %}
        <img class="card-img-top" src="{{ item.image.url }}" alt="{{ item.title }}"/>
      {% endif %}
      <div class="card-body">
        <h5 class="card-title mb-2">{{ item.title }}</h5>
        <p class="card-text muted">{{ item.description }}</p>
        <div class="item-meta mb-3">
          <span><strong>Location:</strong> {{ item.location }}</span>
          <span><strong>Posted:</strong> {{ item.date_posted|date:'M d, Y H:i' }}</span>
          <span><strong>Posted by:</strong> {{ item.posted_by.get_full_name|default:item.posted_by.username }}</span>
          {% if item.found and item.claim_set.exists %}
            <span><strong>Claimed by:</strong> {{ item.claim_set.last.claimed_by.get_full_name|default:item.claim_set.last.claimed_by.username }}</span>
            <span><strong>Claimed on:</strong> {{ item.claim_set.last.claimed_on|date:'M d, Y H:i' }}</span>
          {% endif %}
        </div>
        {% if not item.found %}
          <a href="{% url 'claim_item' item.id %}" class="btn btn-primary">Claim</a>
        {% else %}
          <span class="badge">Claimed</span>
          {% if request.user == item.posted_by %}
            <form method="get" action="{% url 'delete_claimed_item' item.id %}" style="display:inline;">
              <button type="submit" class="btn btn-danger btn-sm ms-2">Delete</button>
            </form>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% empty %}
    <div class="alert alert-secondary">No items yet. Be the first to post one.</div>
  {% endfor %}
</div>
{% endblock %}
